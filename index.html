<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>4班ローテ三交代（上下レイアウト）</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8;
    --accent:#60a5fa; --accent-weak:#3b82f6; --today:#f59e0b; --off:#fda4af;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif}
  .app{min-height:100vh;display:grid;grid-template-rows:auto 1fr;gap:12px;padding:12px;}
  .panel{background:var(--panel);border:1px solid #1f2a44;border-radius:12px;overflow:hidden}

  /* 上：日付ダイヤル（横スクロール） */
  .dial-header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:10px;border-bottom:1px solid #1f2a44;background:#0c1528;}
  .title{font-weight:700}
  .controls{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  .btn{background:#0b1220;color:var(--text);border:1px solid #334155;border-radius:10px;padding:6px 10px;cursor:pointer}
  .btn:hover{border-color:var(--accent-weak);color:var(--accent)}
  input[type="date"]{background:#0b1220;color:var(--text);border:1px solid #334155;border-radius:10px;padding:6px 10px}

  .dial-wheel{display:grid;grid-auto-flow:column;grid-auto-columns: minmax(120px, 1fr);
    gap:10px;overflow:auto;padding:12px;scroll-snap-type:x mandatory}
  .date-item{scroll-snap-align:center;display:grid;gap:6px;align-content:center;justify-items:center;
    padding:12px;border-radius:10px;background:#0e1730;border:1px solid #1f2a44;min-height:84px;cursor:pointer}
  .date-item:hover{border-color:#33507a}
  .ymd{font-weight:700;letter-spacing:.2px}
  .dow{font-size:12px;color:var(--muted)}
  .tag{font-size:11px;color:var(--muted)}
  .today{outline:2px solid var(--today);outline-offset:-2px;background:rgba(245,158,11,.08)}
  .selected{border-color:var(--accent-weak);box-shadow:0 0 0 1px var(--accent-weak) inset}

  /* 下：当日の班割 */
  .grid{padding:14px;display:grid;grid-template-columns:repeat(2,minmax(240px,1fr));gap:12px}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} }
  .card{background:var(--card);border:1px solid #243449;border-radius:12px;padding:14px}
  .card h3{margin:0 0 8px;font-size:16px}
  .row{display:flex;justify-content:space-between;gap:10px;padding:8px 0;border-top:1px dashed #334155}
  .row:first-of-type{border-top:none}
  .label{color:var(--muted)}
  .value{font-weight:700;color:var(--accent)}
  .offbox{background:rgba(253,164,175,.1);border:1px dashed var(--off);padding:10px;border-radius:10px}
  .footer{padding:10px;border-top:1px solid #1f2a44;color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <main class="app">
    <!-- 上：ダイヤル -->
    <section class="panel" aria-label="日付ダイヤル">
      <div class="dial-header">
        <div class="title">日付</div>
        <div class="controls" role="group" aria-label="操作">
          <button class="btn" id="prevWeek" title="前へ7日">← 7日</button>
          <button class="btn" id="todayBtn" title="今日へ">今日</button>
          <button class="btn" id="nextWeek" title="次へ7日">7日 →</button>
          <label style="display:flex;align-items:center;gap:6px">
            指定日
            <input type="date" id="gotoDate" />
          </label>
        </div>
      </div>
      <div id="dialWheel" class="dial-wheel" tabindex="0" aria-label="横にスクロールして日付を選択"></div>
    </section>

    <!-- 下：当日の班割 -->
    <section class="panel" aria-label="シフト詳細">
      <div class="dial-header" style="justify-content:space-between">
        <div id="selDateText" class="title">—</div>
        <div class="controls" style="margin-left:0">
          <span class="btn" style="cursor:default;border-style:dashed">1番 08:00–16:00</span>
          <span class="btn" style="cursor:default;border-style:dashed">2番 16:00–23:00</span>
          <span class="btn" style="cursor:default;border-style:dashed">3番 23:00–08:00</span>
          <span class="btn" style="cursor:default;border-style:dashed;color:var(--off);border-color:var(--off)">休</span>
        </div>
      </div>
      <div class="grid" id="grid"></div>
      <div class="footer">※ ローテ基準は 2026-02-02 の並び（1番=B, 2番=A, 3番=D, 休=C）。以後は毎日ローテーション。</div>
    </section>
  </main>

<script>
/** ====== 勤務パターン設定 ====== */
const slots = [
  { name:"1番", time:"08:00–16:00" },
  { name:"2番", time:"16:00–23:00" },
  { name:"3番", time:"23:00–08:00" },
  { name:"休",  time:"—" }
];
// 4班
const teams = ["A","B","C","D"];

/**
 * ローテ基準（day0）：CSVの 2026-02-02 実績
 * 1番=B, 2番=A, 3番=D, 休=C → [B, A, D, C]
 * （必要があればここを書き換えれば初期並びを変更できます）
 */
const DAY0_DATE = new Date("2026-02-02T00:00:00"); // 固定基準日
const DAY0_ORDER = ["B","A","D","C"];

/** ====== 日付ユーティリティ ====== */
const dow = ["日","月","火","水","木","金","土"];
const addDays = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x; };
const diffDays = (a,b)=> Math.floor((a-b)/(1000*60*60*24));
const toISO = (d)=> { const z=new Date(d); z.setHours(0,0,0,0); return z.toISOString().slice(0,10); };
const fmtYmd = (d)=> `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日（${dow[d.getDay()]}）`;

/** 指定日の担当を計算：DAY0_ORDER を日数差分ぶんローテーション */
function assignmentFor(date){
  const days = diffDays(date, DAY0_DATE);
  const L = DAY0_ORDER.length;
  // date が day0 より n 日後 → 配列を左に n 回回す（1日で 1番→休 が1つ後ろへずれる）
  const order = DAY0_ORDER.map((_,i)=> DAY0_ORDER[(i - (days % L) + L) % L]);
  return slots.map((slot, idx)=> ({ slot:slot.name, time:slot.time, team:order[idx] }));
}

/** ====== 画面要素 ====== */
const dialWheel   = document.getElementById('dialWheel');
const selDateText = document.getElementById('selDateText');
const grid        = document.getElementById('grid');
const prevWeekBtn = document.getElementById('prevWeek');
const nextWeekBtn = document.getElementById('nextWeek');
const todayBtn    = document.getElementById('todayBtn');
const gotoDateInp = document.getElementById('gotoDate');

const TODAY = new Date(); TODAY.setHours(0,0,0,0);

/** 横ダイヤルを中心日付の前後に広げて描画（前後各 3650 日 ≒ 10年分） */
function renderDialAround(centerDate){
  dialWheel.innerHTML = "";
  const span = 3650;
  for(let i=-span;i<=span;i++){
    const d = addDays(centerDate, i);
    const b = document.createElement('button');
    b.className = 'date-item' + (toISO(d)===toISO(TODAY) ? ' today' : '');
    b.setAttribute('data-date', toISO(d));
    b.innerHTML = `
      <div class="ymd">${d.getMonth()+1}/${d.getDate()}</div>
      <div class="dow">${dow[d.getDay()]}</div>
      <div class="tag">${d.getFullYear()}</div>
    `;
    b.addEventListener('click', ()=> selectDate(d, {scrollIntoView:true}));
    dialWheel.appendChild(b);
  }
}

/** 下のカード描画 */
function renderRight(date){
  selDateText.textContent = fmtYmd(date);
  const data = assignmentFor(date);

  grid.innerHTML = "";

  // 1番・2番・3番
  data.slice(0,3).forEach(({slot,time,team})=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <h3>${slot}</h3>
      <div class="row"><div class="label">班</div><div class="value">${team}</div></div>
      <div class="row"><div class="label">時刻</div><div>${time}</div></div>
    `;
    grid.appendChild(card);
  });

  // 休
  const offTeam = data[3].team;
  const offCard = document.createElement('div');
  offCard.className = 'card';
  offCard.innerHTML = `
    <h3>休</h3>
    <div class="offbox">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="label">班</div>
        <div style="font-weight:700;color:var(--off)">${offTeam}</div>
      </div>
    </div>
  `;
  grid.appendChild(offCard);
}

/** 選択処理（ダイヤルと日付指定の双方から呼ばれる） */
function selectDate(d, opts={}){
  renderRight(d);
  // ダイヤルの選択表示
  [...dialWheel.children].forEach(el => {
    el.classList.toggle('selected', el.getAttribute('data-date')===toISO(d));
  });
  // date ピッカーも同期
  gotoDateInp.value = toISO(d);
  // スクロールで中央に寄せる
  if(opts.scrollIntoView){
    const el = [...dialWheel.children].find(x=>x.getAttribute('data-date')===toISO(d));
    if(el){ el.scrollIntoView({inline:'center', block:'nearest', behavior:'smooth'}); }
  }
}

/** 初期化 */
function init(){
  renderDialAround(TODAY);
  selectDate(TODAY, {scrollIntoView:true});

  // ナビゲーション
  prevWeekBtn.addEventListener('click', ()=>{
    const current = new Date(gotoDateInp.value || TODAY);
    const d = addDays(current, -7);
    selectDate(d, {scrollIntoView:true});
  });
  nextWeekBtn.addEventListener('click', ()=>{
    const current = new Date(gotoDateInp.value || TODAY);
    const d = addDays(current, 7);
    selectDate(d, {scrollIntoView:true});
  });
  todayBtn.addEventListener('click', ()=>{
    selectDate(TODAY, {scrollIntoView:true});
  });
  // 日付指定
  gotoDateInp.addEventListener('change', ()=>{
    const v = gotoDateInp.value;
    if(!v) return;
    const d = new Date(v);
    d.setHours(0,0,0,0);
    // 選択日がダイヤル範囲外でも OK。スクロール感演出のため近傍へ寄せる。
    selectDate(d, {scrollIntoView:true});
  });
}

init();
</script>
</body>
</html>

</html>
