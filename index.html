<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>4班・3勤1休ローテ</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111826;
      --text:#e8eef7;
      --muted:#9aa8ba;
      --accent:#46b1ff;
      --sun:#ff5a5a;
      --sat:#5aa9ff;
      --holiday:#ffb020;
      --today:#22c55e;
      --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Sans", "Yu Gothic", sans-serif;
      line-height:1.25;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 24px;
    }
    h1{
      margin: 0 0 10px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing:.02em;
    }
    .sub{
      margin: 0 0 16px;
      color:var(--muted);
      font-size: 14px;
    }

    .toolbar{
      display:flex; flex-wrap:wrap; gap:10px;
      background:var(--panel);
      border:1px solid var(--border);
      padding:12px;
      border-radius:12px;
      align-items:center;
    }
    .toolbar .label{color:var(--muted); font-size:13px}
    .toolbar input[type="date"]{
      background:#0f1624; color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 12px;
      font-size:16px;
    }
    .btn{
      background:#0f1624; color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 12px;
      font-size:16px;
      cursor:pointer;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{border-color: rgba(70,177,255,.5)}
    .btn.primary:hover{background: rgba(70,177,255,.08)}
    .spacer{flex:1}
    .note{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    /* 大きく表示（スクロールなし想定） */
    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
    }
    .dateRow{
      display:flex; align-items:baseline; gap:10px;
      margin-bottom: 8px;
    }
    .dateBig{
      font-size: 40px;
      font-weight: 900;
      letter-spacing:.02em;
    }
    .dow{
      font-size: 18px;
      font-weight: 800;
      color:var(--muted);
    }
    .badge{
      margin-left:auto;
      font-size: 13px;
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--border);
      color: var(--muted);
    }
    .badge.today{
      border-color: rgba(34,197,94,.5);
      color: var(--today);
      background: rgba(34,197,94,.08);
    }
    .badge.holiday{
      border-color: rgba(255,176,32,.5);
      color: var(--holiday);
      background: rgba(255,176,32,.10);
    }

    .shiftRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .shiftBox{
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 14px 14px;
      background: rgba(0,0,0,.12);
    }
    .shiftName{
      font-size: 18px;
      font-weight: 900;
      margin-bottom: 8px;
      color: var(--muted);
    }
    .shiftVal{
      font-size: 32px;
      font-weight: 1000;
      letter-spacing:.02em;
    }
    .legend{
      margin-top: 14px;
      color: var(--muted);
      font-size: 13px;
    }
    .legend b{color:var(--text)}
    .colorSun{color:var(--sun)}
    .colorSat{color:var(--sat)}
    .colorHol{color:var(--holiday)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>4班・3勤1休ローテ（三交代）</h1>
    <p class="sub">
      3勤1休（例：1,1,1,休,3,3,3,休,2,2,2,休）。基準日 2026-02-02（1番=B, 2番=A, 3番=D, 休=C）。初期表示は「今日」。[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)
    </p>

    <div class="toolbar">
      <span class="label">日付</span>
      <button class="btn" id="prev7">← 7日</button>
      <button class="btn primary" id="todayBtn">今日</button>
      <button class="btn" id="next7">7日 →</button>

      <span class="spacer"></span>

      <span class="label">指定日</span>
      <input type="date" id="picker" />
      <span class="note" id="tzNote"></span>
    </div>

    <div class="grid">
      <div class="card" id="cardMain"></div>
      <div class="card" id="cardNext"></div>
    </div>

    <div class="legend">
      色：<span class="colorSun"><b>日</b></span> / <span class="colorSat"><b>土</b></span> / <span class="colorHol"><b>祝</b></span>（祝日は土日より優先で表示）
    </div>
  </div>

<script>
/* =========================
   重要：日付処理（ズレ防止）
   - toISOString() を使わない
   - new Date("YYYY-MM-DD") を使わない
   ========================= */

// ローカルで YYYY-MM-DD を作る（祝日突合のキーに使う）
function ymdLocal(d){
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

// "YYYY-MM-DD" をローカル日付として作る（UTC解釈を避ける）
function parseYMDLocal(s){
  const [y,m,d] = s.split('-').map(Number);
  return new Date(y, m-1, d); // ローカル 00:00
}

// 日の加算（ローカル日付で安定）
function addDaysLocal(d, days){
  return new Date(d.getFullYear(), d.getMonth(), d.getDate() + days);
}

// 「日単位差分」を安全に（正午固定で境界の罠回避）
function diffDaysLocal(a, b){
  const A = new Date(a.getFullYear(), a.getMonth(), a.getDate(), 12);
  const B = new Date(b.getFullYear(), b.getMonth(), b.getDate(), 12);
  return Math.round((A - B) / 86400000);
}

/* =========================
   祝日データ（例）
   - 必要なら増やしてください
   - 祝日キーは "YYYY-MM-DD" 文字列で統一
   ========================= */
const holidaySet = new Set([
  // 2026（例：一部）
  "2026-01-01",
  "2026-01-12",
  "2026-02-11",
  "2026-02-23",
  "2026-03-20",
  "2026-04-29",
  "2026-05-03",
  "2026-05-04",
  "2026-05-05",
  "2026-07-20",
  "2026-09-21",
  "2026-09-22",
  "2026-10-12",
  "2026-11-03",
  "2026-11-23"
]);

function isHoliday(d){
  return holidaySet.has(ymdLocal(d));
}

/* =========================
   ローテ設定（要件）
   基準：2026-02-02（1番=B, 2番=A, 3番=D, 休=C）
   3勤1休：勤務種別は 1→休→3→休→2→休 …（各3日ずつ）
   班の割り当ては日ごとに 4班が順繰り
   ========================= */
const baseDate = parseYMDLocal("2026-02-02"); // ←UTCズレ回避
const groupNames = ["A","B","C","D"];

// 基準日の割当：1番=B, 2番=A, 3番=D, 休=C
const baseAssign = { "1番":"B", "2番":"A", "3番":"D", "休":"C" };

// 勤務種別サイクル（4日周期）：[1,1,1,休, 3,3,3,休, 2,2,2,休] …を4日単位で表現
// ここでは「ブロック単位（4日）」として 1→3→2 を回す
const blockKinds = ["1", "3", "2"]; // それぞれ 3勤 + 休 で4日ブロック
const shiftLabel = {
  "1": "08:00–16:00",
  "2": "16:00–23:00",
  "3": "23:00–08:00",
  "休": "休"
};

// n日後の勤務種別（1/2/3/休）
function workKindAt(date){
  const dd = diffDaysLocal(date, baseDate);
  const pos = ((dd % 4) + 4) % 4;         // 0..3
  const blockIndex = Math.floor(dd / 4);  // ブロック番号（負もあり）
  // JSの負のfloor対応
  const bi = (dd >= 0) ? blockIndex : Math.floor((dd - 3) / 4);

  // どのブロックか（1→3→2…）
  const kind = blockKinds[((bi % 3) + 3) % 3];
  if(pos === 3) return "休";
  return kind;
}

// 班の回り方（4班が毎日 1番→2番→3番→休 の「位置」を1つ進む想定）
// 基準日の位置： {1番:B, 2番:A, 3番:D, 休:C} を、日数だけ「位置」を回転
const positions = ["1番","2番","3番","休"];
function assignmentAt(date){
  const dd = diffDaysLocal(date, baseDate);
  const rot = ((dd % 4) + 4) % 4;

  // posをrotだけ進める（例：翌日は 1番にいた班が2番へ…）
  const result = {};
  for(let i=0;i<4;i++){
    const posFrom = positions[i];
    const posTo = positions[(i + rot) % 4];
    result[posTo] = baseAssign[posFrom];
  }
  return result;
}

// 班ごとの「今日の勤務表示」を作る
function buildShiftView(date){
  const kind = workKindAt(date);
  const assign = assignmentAt(date); // 位置→班

  // 各位置（1番/2番/3番/休）に対して、今日の勤務種別kindを当てはめる…のではなく
  // “位置=勤務”なので、kindは「どの勤務(1/2/3)が3日連続か」の概念。
  // ここでは「1番/2番/3番/休」は固定で、表示は shiftLabel のとおり。
  // ただし「3勤1休の切替」を反映するため、今日のkindで “1番/2番/3番” を入れ替える方式もあるが、
  // 元文の例に合わせ、勤務種別の流れ自体（1→3→2）を “担当位置の意味” として扱う。
  //
  // つまり：今日の「1番枠」は kind の時間帯、明日も同じ、3日後に休、次のブロックで「1番枠」が次の時間帯…という見立て。
  const map = {};
  // 今日のkindを「1番」に割り当て、残りは順に2/3、休は休。
  // kindが"1"なら {1番:1,2番:2,3番:3,休:休}
  // kindが"3"なら {1番:3,2番:1,3番:2,休:休} のように回す
  const orderByKind = {
    "1": ["1","2","3","休"],
    "3": ["3","1","2","休"],
    "2": ["2","3","1","休"],
    "休": ["休","休","休","休"]
  }[kind];

  for(let i=0;i<4;i++){
    const pos = positions[i];
    map[pos] = orderByKind[i];
  }

  // 班ごとに最終表示（班→勤務）
  const groupToWork = {};
  for(const pos of positions){
    const g = assign[pos];
    groupToWork[g] = map[pos];
  }

  return { kind, assign, groupToWork };
}

/* =========================
   UI 描画
   ========================= */
const dowJP = ["日","月","火","水","木","金","土"];

function dayClass(date){
  if(isHoliday(date)) return "holiday";
  const dow = date.getDay();
  if(dow === 0) return "sun";
  if(dow === 6) return "sat";
  return "wd";
}

function renderCard(el, date, title){
  const ymd = ymdLocal(date);
  const dow = dowJP[date.getDay()];
  const today = ymdLocal(new Date()) === ymd;
  const hol = isHoliday(date);

  const view = buildShiftView(date);
  const g = view.groupToWork;

  const badge = hol ? `<span class="badge holiday">祝日</span>` :
               today ? `<span class="badge today">今日</span>` :
               `<span class="badge">${title}</span>`;

  el.innerHTML = `
    <div class="dateRow">
      <div class="dateBig">${ymd}</div>
      <div class="dow">${dow}</div>
      ${badge}
    </div>
    <div class="shiftRow">
      <div class="shiftBox">
        <div class="shiftName">A班</div>
        <div class="shiftVal">${shiftLabel[g["A"]]}</div>
      </div>
      <div class="shiftBox">
        <div class="shiftName">B班</div>
        <div class="shiftVal">${shiftLabel[g["B"]]}</div>
      </div>
      <div class="shiftBox">
        <div class="shiftName">C班</div>
        <div class="shiftVal">${shiftLabel[g["C"]]}</div>
      </div>
      <div class="shiftBox">
        <div class="shiftName">D班</div>
        <div class="shiftVal">${shiftLabel[g["D"]]}</div>
      </div>
    </div>
  `;

  // 日付全体の色味（祝日優先）
  const cls = dayClass(date);
  el.style.borderColor = "rgba(255,255,255,.08)";
  if(cls === "holiday") el.style.borderColor = "rgba(255,176,32,.55)";
  if(cls === "sun") el.style.borderColor = "rgba(255,90,90,.55)";
  if(cls === "sat") el.style.borderColor = "rgba(90,169,255,.55)";
}

/* =========================
   操作
   ========================= */
let current = new Date(); // 初期表示「今日」[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)

const cardMain = document.getElementById("cardMain");
const cardNext = document.getElementById("cardNext");
const picker = document.getElementById("picker");
const tzNote = document.getElementById("tzNote");

function syncPicker(){
  picker.value = ymdLocal(current);
}
function render(){
  renderCard(cardMain, current, "指定日");
  renderCard(cardNext, addDaysLocal(current, 1), "翌日");
  syncPicker();
}

document.getElementById("todayBtn").addEventListener("click", ()=>{
  current = new Date();
  render();
});
document.getElementById("prev7").addEventListener("click", ()=>{
  current = addDaysLocal(current, -7);
  render();
});
document.getElementById("next7").addEventListener("click", ()=>{
  current = addDaysLocal(current, +7);
  render();
});
picker.addEventListener("change", ()=>{
  if(!picker.value) return;
  current = parseYMDLocal(picker.value);
  render();
});

// タイムゾーン表示
(function(){
  const offsetMin = -new Date().getTimezoneOffset();
  const sign = offsetMin >= 0 ? "+" : "-";
  const hh = String(Math.floor(Math.abs(offsetMin)/60)).padStart(2,"0");
  const mm = String(Math.abs(offsetMin)%60).padStart(2,"0");
  tzNote.textContent = `TZ: UTC${sign}${hh}:${mm}（ズレ対策：ローカル日付固定）`;
})();

render();
</script>
</body>
</html>
