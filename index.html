<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>4班・3勤1休ローテ（三交代・上下レイアウト／一段表示）</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8;
    --accent:#60a5fa; --accent-weak:#3b82f6; --today:#f59e0b; --off:#fda4af;

    /* 班カラー（ビビッド：班名の強調に使用） */
    --A:#22d3ee;  /* A: シアン */
    --B:#a78bfa;  /* B: パープル */
    --C:#34d399;  /* C: グリーン */
    --D:#fbbf24;  /* D: アンバー */

    /* スロット（番）カラー：淡色（番の見出し左線だけに使用） */
    --S1:#3b82f6; /* 1番: ブルー系（淡） */
    --S2:#10b981; /* 2番: グリーン系（淡） */
    --S3:#f59e0b; /* 3番: オレンジ系（淡） */
    --Sx:#fda4af; /* 休:   ピンク系（淡） */
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif}
  .app{min-height:100vh;display:grid;grid-template-rows:auto 1fr;gap:12px;padding:12px;}
  .panel{background:var(--panel);border:1px solid #1f2a44;border-radius:12px;overflow:hidden}

  /* 上：日付ダイヤル（横スクロール） */
  .dial-header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:10px;border-bottom:1px solid #1f2a44;background:#0c1528;}
  .title{font-weight:800;font-size:18px;letter-spacing:.3px}
  .controls{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  .btn{background:#0b1220;color:var(--text);border:1px solid #334155;border-radius:10px;padding:6px 10px;cursor:pointer}
  .btn:hover{border-color:var(--accent-weak);color:var(--accent)}
  input[type="date"]{background:#0b1220;color:var(--text);border:1px solid #334155;border-radius:10px;padding:6px 10px}

  .dial-wheel{display:grid;grid-auto-flow:column;grid-auto-columns:minmax(120px,1fr);
    gap:10px;overflow:auto;padding:12px;scroll-snap-type:x mandatory}
  .date-item{scroll-snap-align:center;display:grid;gap:6px;align-content:center;justify-items:center;
    padding:12px;border-radius:10px;background:#0e1730;border:1px solid #1f2a44;min-height:84px;cursor:pointer}
  .date-item:hover{border-color:#33507a}
  .ymd{font-weight:800;letter-spacing:.2px;font-size:16px}
  .dow{font-size:12px;color:var(--muted)}
  .tag{font-size:11px;color:var(--muted)}
  .today{outline:2px solid var(--today);outline-offset:-2px;background:rgba(245,158,11,.08)}
  .selected{border-color:var(--accent-weak);box-shadow:0 0 0 1px var(--accent-weak) inset}

  /* 下：当日の班割（一段・横スクロール） */
  .grid{
    display:grid;
    grid-auto-flow:column;               /* ← 常に1段（横並び） */
    grid-auto-columns:minmax(280px,1fr); /* ← カード最小幅を少し広げた */
    gap:12px;
    padding:14px;
    overflow-x:auto;
  }
  .card{background:var(--card);border:1px solid #243449;border-radius:12px;padding:16px;min-height:160px}
  /* 見出し（番）は中立色。左線だけ淡い“番色”で差し色（班色とは別系統） */
  .card h3{
    margin:0 0 12px;
    font-size:22px;           /* ← 番見出しを大きく */
    font-weight:900;
    letter-spacing:.5px;
    color:var(--text);
    padding-left:12px;
    border-left:6px solid #334155; /* デフォルト（後で上書き） */
  }
  .h-slot-1 h3{ border-left-color: var(--S1); }
  .h-slot-2 h3{ border-left-color: var(--S2); }
  .h-slot-3 h3{ border-left-color: var(--S3); }
  .h-slot-x h3{ border-left-color: var(--Sx); }

  .row{display:flex;justify-content:space-between;gap:10px;padding:12px 0;border-top:1px dashed #334155}
  .row:first-of-type{border-top:none}
  .label{color:var(--muted);font-size:14px}
  /* 班名：さらに強調（大/極太/字間広め） */
  .value{
    font-weight:900;
    font-size:28px;           /* ← 以前よりさらに大きく */
    letter-spacing:.6px;
  }

  /* 班の色（班名だけに効く：見出し色とは独立） */
  .team-A .value{ color: var(--A); }
  .team-B .value{ color: var(--B); }
  .team-C .value{ color: var(--C); }
  .team-D .value{ color: var(--D); }

  /* 休カードの中身 */
  .offbox{background:rgba(253,164,175,.1);border:1px dashed var(--off);padding:12px;border-radius:10px}
  .footer{padding:10px;border-top:1px solid #1f2a44;color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <main class="app">
    <!-- 上：ダイヤル -->
    <section class="panel" aria-label="日付ダイヤル">
      <div class="dial-header">
        <div class="title">日付</div>
        <div class="controls" role="group" aria-label="操作">
          <button class="btn" id="prevWeek" title="前へ7日">← 7日</button>
          <button class="btn" id="todayBtn" title="今日へ">今日</button>
          <button class="btn" id="nextWeek" title="次へ7日">7日 →</button>
          <label style="display:flex;align-items:center;gap:6px">
            指定日
            <input type="date" id="gotoDate" />
          </label>
        </div>
      </div>
      <div id="dialWheel" class="dial-wheel" tabindex="0" aria-label="横にスクロールして日付を選択"></div>
    </section>

    <!-- 下：当日の班割（1段） -->
    <section class="panel" aria-label="シフト詳細">
      <div class="dial-header" style="justify-content:space-between">
        <div id="selDateText" class="title">—</div>
        <div class="controls" style="margin-left:0">
          <span class="btn" style="cursor:default;border-style:dashed">1番 08:00–16:00</span>
          <span class="btn" style="cursor:default;border-style:dashed">2番 16:00–23:00</span>
          <span class="btn" style="cursor:default;border-style:dashed">3番 23:00–08:00</span>
          <span class="btn" style="cursor:default;border-style:dashed;color:var(--off);border-color:var(--off)">休</span>
        </div>
      </div>
      <div class="grid" id="grid"></div>
      <div class="footer">
        ※ 各班は <b>3勤1休</b>（Aの例：1,1,1,休,3,3,3,休,2,2,2,休）。<br/>
        ※ ローテ基準は 2026-02-02 の実績（1番=B, 2番=A, 3番=D, 休=C）。初期表示は常に「今日」です。[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/_layouts/15/Doc.aspx?sourcedoc=%7B5583F174-C593-41F5-8351-0688521D8C40%7D&file=shift_2026_2035.csv&action=default&mobileredirect=true)
      </div>
    </section>
  </main>

<script>
/** ====== 3勤1休ローテ（12日周期） ====== */
const CYCLE = ["1","1","1","休","3","3","3","休","2","2","2","休"];
const PERIOD = CYCLE.length;

/** day0 で 1番=B, 2番=A, 3番=D, 休=C を満たす位相（δ=0,3,6,9） */
const PHASE = { A:9, B:0, C:3, D:6 };

/** スロット（番） */
const SLOTS = {
  "1": { name:"1番", time:"08:00–16:00", hClass:"h-slot-1" },
  "2": { name:"2番", time:"16:00–23:00", hClass:"h-slot-2" },
  "3": { name:"3番", time:"23:00–08:00", hClass:"h-slot-3" },
  "休": { name:"休",  time:"—",           hClass:"h-slot-x" }
};

/** 班→色クラス（班名の値に掛かる） */
const TEAM_CLASS = { A:"team-A", B:"team-B", C:"team-C", D:"team-D" };

/** ====== 日付ユーティリティ ====== */
const dow = ["日","月","火","水","木","金","土"];
const addDays = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x; };
const diffDays = (a,b)=> Math.floor((a-b)/(1000*60*60*24));
const toISO = (d)=> { const z=new Date(d); z.setHours(0,0,0,0); return z.toISOString().slice(0,10); };
const fmtYmd = (d)=> `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日（${dow[d.getDay()]}）`;

/** ====== 基準日 ======
 * ローテ基準（day0）は CSV 実績の 2026-02-02。初期表示は “今日” にします。
 */
const DAY0_DATE = new Date("2026-02-02T00:00:00"); // ローテ基準
const TODAY = new Date(); TODAY.setHours(0,0,0,0);  // 初期表示

/** 指定日のスロット→班（毎日「1・2・3・休」が一つずつ） */
function assignmentFor(date){
  const n = ((diffDays(date, DAY0_DATE) % PERIOD) + PERIOD) % PERIOD;
  const symbolOfTeam = {};
  Object.keys(PHASE).forEach(team=>{
    const idx = (n + PHASE[team]) % PERIOD;
    symbolOfTeam[team] = CYCLE[idx];
  });
  const result = { "1":null, "2":null, "3":null, "休":null };
  Object.entries(symbolOfTeam).forEach(([team, sym])=>{
    result[sym] = team;
  });
  return result; // {"1":"A|B|C|D", "2":..., "3":..., "休":...}
}

/** ====== 画面要素 ====== */
const dialWheel   = document.getElementById('dialWheel');
const selDateText = document.getElementById('selDateText');
const grid        = document.getElementById('grid');
const prevWeekBtn = document.getElementById('prevWeek');
const nextWeekBtn = document.getElementById('nextWeek');
const todayBtn    = document.getElementById('todayBtn');
const gotoDateInp = document.getElementById('gotoDate');

/** ダイヤル描画（前後各10年） */
function renderDialAround(centerDate){
  dialWheel.innerHTML = "";
  const span = 3650;
  for(let i=-span;i<=span;i++){
    const d = addDays(centerDate, i);
    const b = document.createElement('button');
    b.className = 'date-item' + (toISO(d)===toISO(TODAY) ? ' today' : '');
    b.setAttribute('data-date', toISO(d));
    b.innerHTML = `
      <div class="ymd">${d.getMonth()+1}/${d.getDate()}</div>
      <div class="dow">${dow[d.getDay()]}</div>
      <div class="tag">${d.getFullYear()}</div>
    `;
    b.addEventListener('click', ()=> selectDate(d, {scrollIntoView:true}));
    dialWheel.appendChild(b);
  }
}

/** 下のカード描画（常に横一列） */
function renderRight(date){
  selDateText.textContent = fmtYmd(date);
  const map = assignmentFor(date); // {"1":team, "2":team, "3":team, "休":team}
  grid.innerHTML = "";

  const makeCard = (sym)=>{
    const team = map[sym];
    const card = document.createElement('div');
    const hClass = SLOTS[sym].hClass;
    card.className = `card ${hClass} ${TEAM_CLASS[team] || ""}`;
    card.innerHTML = `
      <h3>${SLOTS[sym].name}</h3>
      <div class="row"><div class="label">班</div><div class="value">${team}</div></div>
      <div class="row"><div class="label">時刻</div><div>${SLOTS[sym].time}</div></div>
    `;
    return card;
  };

  grid.appendChild(makeCard("1"));
  grid.appendChild(makeCard("2"));
  grid.appendChild(makeCard("3"));

  // 休
  const offTeam = map["休"];
  const offCard = document.createElement('div');
  offCard.className = 'card h-slot-x';
  offCard.innerHTML = `
    <h3>休</h3>
    <div class="offbox">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="label">班</div>
        <div style="font-weight:900;color:var(--off);font-size:28px;letter-spacing:.6px">${offTeam}</div>
      </div>
    </div>
  `;
  grid.appendChild(offCard);
}

/** 選択処理（ダイヤル＆dateピッカーから呼ぶ） */
function selectDate(d, opts={}){
  renderRight(d);
  // ダイヤルの選択表示
  [...dialWheel.children].forEach(el => {
    el.classList.toggle('selected', el.getAttribute('data-date')===toISO(d));
  });
  // date ピッカー同期
  gotoDateInp.value = toISO(d);
  if(opts.scrollIntoView){
    const el = [...dialWheel.children].find(x=>x.getAttribute('data-date')===toISO(d));
    if(el){ el.scrollIntoView({inline:'center', block:'nearest', behavior:'smooth'}); }
  }
}

/** 初期化：初期表示は“今日” */
function init(){
  renderDialAround(TODAY);
  selectDate(TODAY, {scrollIntoView:true});  // ← 開いた日の割当を表示

  // ナビ
  prevWeekBtn.addEventListener('click', ()=>{
    const current = new Date(gotoDateInp.value || TODAY);
    const d = addDays(current, -7);
    selectDate(d, {scrollIntoView:true});
  });
  nextWeekBtn.addEventListener('click', ()=>{
    const current = new Date(gotoDateInp.value || TODAY);
    const d = addDays(current, 7);
    selectDate(d, {scrollIntoView:true});
  });
  todayBtn.addEventListener('click', ()=>{
    selectDate(TODAY, {scrollIntoView:true});
  });
  // 日付指定
  gotoDateInp.addEventListener('change', ()=>{
    const v = gotoDateInp.value;
    if(!v) return;
    const d = new Date(v);
    d.setHours(0,0,0,0);
    selectDate(d, {scrollIntoView:true});
  });
}

init();
</script>
</body>
</html>

