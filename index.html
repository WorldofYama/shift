<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>4班・3勤1休ローテ</title>
<style>
  body{font-family:system-ui, -apple-system, "Segoe UI", "Noto Sans JP", sans-serif; margin:16px;}
  .bar{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:12px;}
  button,input{font-size:18px; padding:8px 10px;}
  .date{font-size:40px; font-weight:900; margin:10px 0 6px;}
  .tag{display:inline-block; padding:4px 10px; border-radius:999px; font-weight:800; margin-left:8px; font-size:14px;}
  .tag.today{background:#e7f7ec; color:#0a7a2f;}
  .tag.holiday{background:#fff4dd; color:#b86b00;}
  .tag.sun{background:#ffe4e4; color:#b40000;}
  .tag.sat{background:#e6f0ff; color:#0047b4;}
  .grid{display:grid; grid-template-columns:repeat(2, minmax(0, 1fr)); gap:10px; margin-top:10px;}
  .box{border:1px solid #ddd; border-radius:12px; padding:12px;}
  .name{font-size:16px; color:#555; font-weight:800;}
  .val{font-size:28px; font-weight:900; margin-top:6px;}
  @media (max-width: 720px){ .grid{grid-template-columns:1fr;} }
  .note{color:#666; font-size:13px; margin-top:10px;}
</style>
</head>
<body>

<div class="bar">
  <span style="font-weight:900;">日付</span>
  <button id="prev7">← 7日</button>
  <button id="today">今日</button>
  <button id="next7">7日 →</button>
  <span style="margin-left:auto; font-weight:900;">指定日</span>
  <input type="date" id="picker">
</div>

<div id="view"></div>

<div class="note">
  仕様：3勤1休（例：1,1,1,休,3,3,3,休,2,2,2,休）。基準は 2026‑02‑02（1番=B, 2番=A, 3番=D, 休=C）。初期表示は「今日」。[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)
</div>

<script>
/* ========= 祝日ズレ対策の核心 =========
   - 絶対に toISOString() を使わない
   - "YYYY-MM-DD" 文字列→Date は new Date("...") じゃなく (y,m-1,d) で作る
*/
function ymdLocal(d){
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function parseYMDLocal(s){
  const [y,m,d] = s.split('-').map(Number);
  return new Date(y, m-1, d); // ローカル 00:00
}
function addDays(d, n){
  return new Date(d.getFullYear(), d.getMonth(), d.getDate()+n);
}

/* ========= 祝日データ（ここをあなたのリストに差し替え） =========
   形式は "YYYY-MM-DD" の配列が一番ラク
*/
const HOLIDAYS = [
  // 例：2026年の一部（必要に応じて増やして）
  "2026-02-11",
  "2026-02-23",
  "2026-03-20"
];
const holidaySet = new Set(HOLIDAYS);
function isHoliday(d){ return holidaySet.has(ymdLocal(d)); }

/* ========= ローテ仕様（あなたのメモに合わせる） ========= */
const baseDate = parseYMDLocal("2026-02-02"); // 基準日[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)
const baseAssign = { "1番":"B", "2番":"A", "3番":"D", "休":"C" }; // [1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)
const positions = ["1番","2番","3番","休"];

// 3勤1休ブロック：1 → 3 → 2 を回す（例に合わせた並び）[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)
const blockKinds = ["1","3","2"];
const shiftLabel = { "1":"08:00–16:00", "2":"16:00–23:00", "3":"23:00–08:00", "休":"休" };

function diffDays(a,b){
  // 日付境界の罠回避：正午固定
  const A = new Date(a.getFullYear(), a.getMonth(), a.getDate(), 12);
  const B = new Date(b.getFullYear(), b.getMonth(), b.getDate(), 12);
  return Math.round((A - B) / 86400000);
}
function workKindAt(date){
  const dd = diffDays(date, baseDate);
  const pos = ((dd % 4)+4)%4; // 0..3
  // ブロック番号（負のときもそれっぽく）
  const bi = (dd>=0) ? Math.floor(dd/4) : Math.floor((dd-3)/4);
  const kind = blockKinds[((bi%3)+3)%3];
  return (pos===3) ? "休" : kind;
}
function assignmentAt(date){
  const dd = diffDays(date, baseDate);
  const rot = ((dd%4)+4)%4;
  const result = {};
  for(let i=0;i<4;i++){
    const posFrom = positions[i];
    const posTo   = positions[(i+rot)%4];
    result[posTo] = baseAssign[posFrom];
  }
  return result; // 位置→班
}
function groupToShiftAt(date){
  const kind = workKindAt(date);
  const assign = assignmentAt(date);

  // 今日の kind を起点に「1番枠に来る勤務」を決める
  const orderByKind = {
    "1":["1","2","3","休"],
    "3":["3","1","2","休"],
    "2":["2","3","1","休"],
    "休":["休","休","休","休"]
  }[kind];

  const posToWork = {};
  for(let i=0;i<4;i++) posToWork[positions[i]] = orderByKind[i];

  const g2w = {};
  for(const pos of positions){
    const g = assign[pos];
    g2w[g] = posToWork[pos];
  }
  return g2w; // A/B/C/D → 1/2/3/休
}

/* ========= 表示 ========= */
const dowJP = ["日","月","火","水","木","金","土"];
function dayTag(d){
  if(isHoliday(d)) return {text:"祝日", cls:"holiday"};
  const w = d.getDay();
  if(w===0) return {text:"日", cls:"sun"};
  if(w===6) return {text:"土", cls:"sat"};
  return null;
}

let current = new Date(); // 初期表示「今日」[1](https://ubeglobal-my.sharepoint.com/personal/32607u_ube_com/Documents/Whiteboards/Microsoft%20Copilot%20%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/%E3%81%84%E3%81%A1%E3%81%AB%E3%81%A1%E3%81%9A%E3%82%8C.txt)
const picker = document.getElementById("picker");
const view = document.getElementById("view");

function render(){
  const ymd = ymdLocal(current);
  picker.value = ymd;

  const isToday = (ymdLocal(new Date()) === ymd);
  const tag = dayTag(current);

  const g2w = groupToShiftAt(current);
  const tagHtml = [
    isToday ? `<span class="tag today">今日</span>` : ``,
    tag ? `<span class="tag ${tag.cls}">${tag.text}</span>` : ``
  ].join("");

  view.innerHTML = `
    <div class="date">${ymd}（${dowJP[current.getDay()]}）${tagHtml}</div>
    <div class="grid">
      <div class="box"><div class="name">A班</div><div class="val">${shiftLabel[g2w["A"]]}</div></div>
      <div class="box"><div class="name">B班</div><div class="val">${shiftLabel[g2w["B"]]}</div></div>
      <div class="box"><div class="name">C班</div><div class="val">${shiftLabel[g2w["C"]]}</div></div>
      <div class="box"><div class="name">D班</div><div class="val">${shiftLabel[g2w["D"]]}</div></div>
    </div>
  `;
}

document.getElementById("today").onclick = ()=>{ current = new Date(); render(); };
document.getElementById("prev7").onclick = ()=>{ current = addDays(current,-7); render(); };
document.getElementById("next7").onclick = ()=>{ current = addDays(current,+7); render(); };
picker.onchange = ()=>{ if(picker.value) { current = parseYMDLocal(picker.value); render(); } };

render();
</script>
</body>
</html>
